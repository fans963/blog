<button
  id="theme-toggle"
  class="md-icon-button text-[var(--color-md-on-surface-variant)]"
  aria-label="切换主题"
>
  <span class="material-symbols-outlined theme-icon">dark_mode</span>
</button>

<script>
  const themeToggle = document.getElementById('theme-toggle');
  const themeIcon = themeToggle?.querySelector('.theme-icon');

  function getInitialTheme(): 'light' | 'dark' {
    if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
      return localStorage.getItem('theme') as 'light' | 'dark';
    }
    if (typeof window !== 'undefined' && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
    return 'light';
  }

  function updateTheme(theme: 'light' | 'dark') {
    document.documentElement.classList.toggle('dark', theme === 'dark');
    localStorage.setItem('theme', theme);
    if (themeIcon) {
      themeIcon.textContent = theme === 'light' ? 'dark_mode' : 'light_mode';
    }
  }

  function toggleTheme() {
    const currentTheme = getInitialTheme();
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    updateTheme(newTheme);
  }

  themeToggle?.addEventListener('click', toggleTheme);

  // Initialize theme
  updateTheme(getInitialTheme());
</script>
