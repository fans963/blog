---
interface Props {
  title: string;
  description: string;
  date: string;
  category?: string;
  tags?: string[];
  href: string;
  image?: string;
  readTime?: string;
  featured?: boolean;
}

const {
  title,
  description,
  date,
  category,
  tags = [],
  href,
  image,
  readTime,
  featured = false,
} = Astro.props;

const formattedDate = new Date(date).toLocaleDateString('zh-CN', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<article class:list={[
  'md-card overflow-hidden group',
  featured ? 'md:grid md:grid-cols-2' : ''
]}>
  {image && (
    <div class:list={[
      'relative overflow-hidden bg-[var(--color-md-surface-variant)]',
      featured ? 'h-48 md:h-full min-h-[200px]' : 'h-48'
    ]}>
      <img
        src={image}
        alt={title}
        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
        loading={featured ? 'eager' : 'lazy'}
      />
      <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
    </div>
  )}

  <div class="flex flex-col justify-between p-5">
    <div>
      <!-- Meta info -->
      <div class="flex items-center gap-2 mb-3 flex-wrap">
        {category && (
          <span class="md-chip text-xs">
            {category}
          </span>
        )}
        <span class="label-small text-[var(--color-md-on-surface-variant)] flex items-center gap-1">
          <span class="material-symbols-outlined text-xs">calendar_today</span>
          {formattedDate}
        </span>
        {readTime && (
          <span class="label-small text-[var(--color-md-on-surface-variant)] flex items-center gap-1">
            <span class="material-symbols-outlined text-xs">schedule</span>
            {readTime}
          </span>
        )}
      </div>

      <!-- Title -->
      <h2 class:list={[
        'font-medium text-[var(--color-md-on-surface)] mb-2 transition-colors group-hover:text-[var(--color-md-primary)]',
        featured ? 'headline-small' : 'title-large'
      ]}>
        <a href={href} class="focus:outline-none">
          <span class="absolute inset-0" aria-hidden="true"></span>
          {title}
        </a>
      </h2>

      <!-- Description -->
      <p class:list={[
        'text-[var(--color-md-on-surface-variant)] line-clamp-3',
        featured ? 'body-large' : 'body-medium'
      ]}>
        {description}
      </p>
    </div>

    <!-- Footer -->
    <div class="flex items-center justify-between mt-4 pt-4 border-t border-[var(--color-md-outline-variant)]">
      <div class="flex items-center gap-2 flex-wrap">
        {tags.slice(0, 3).map((tag) => (
          <span class="label-small text-[var(--color-md-on-surface-variant)] px-2 py-0.5 bg-[var(--color-md-surface-variant)] rounded">
            #{tag}
          </span>
        ))}
        {tags.length > 3 && (
          <span class="label-small text-[var(--color-md-on-surface-variant)]">
            +{tags.length - 3}
          </span>
        )}
      </div>

      <a
        href={href}
        class="flex items-center gap-1 text-[var(--color-md-primary)] hover:gap-2 transition-all duration-200"
        aria-label={`阅读更多: ${title}`}
      >
        <span class="label-medium">阅读更多</span>
        <span class="material-symbols-outlined text-sm">arrow_forward</span>
      </a>
    </div>
  </div>
</article>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  article {
    position: relative;
  }

  article > a {
    position: absolute;
    inset: 0;
    z-index: 1;
  }
</style>
